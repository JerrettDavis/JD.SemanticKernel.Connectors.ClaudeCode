# JD.SemanticKernel.Connectors.ClaudeCode — Knowledgebase

> **Generated by:** jdxplr — AI Codebase Knowledge Generator  
> **Source repository:** `C:\git\ClaudeCodeAuthenticationProvider`

---

## Project Overview

**JD.SemanticKernel.Connectors.ClaudeCode** is a NuGet library that bridges a locally-installed
[Claude Code](https://claude.ai/download) OAuth session into
[Microsoft Semantic Kernel](https://github.com/microsoft/semantic-kernel), eliminating the need
to manually manage Anthropic API keys. It resolves credentials automatically from the Claude CLI's
local credentials file, environment variables, or explicit configuration — in a well-defined
priority order.

The repository also ships three **proof-of-concept CLI tools** built on top of the connector,
demonstrating real-world agentic workflows with Semantic Kernel.

---

## Repository at a Glance

| Item | Detail |
|------|--------|
| **Primary project** | `JD.SemanticKernel.Connectors.ClaudeCode` (NuGet package) |
| **Current version** | `0.1-preview` (managed by Nerdbank.GitVersioning) |
| **Target frameworks** | `netstandard2.0`, `net8.0`, `net10.0` |
| **License** | MIT |
| **Language** | C# (latest language version) |
| **Total source** | ~6,300 lines C# across 51 files |
| **Test coverage** | xUnit across 4 test projects + coverlet |
| **Documentation** | DocFX site under `docs/` |

---

## Features

- **Zero-config authentication** — reads `~/.claude/.credentials.json` automatically
- **Multi-source credential resolution** — options → env vars → local session, in strict priority order
- **OAuth & API key support** — handles `sk-ant-oat*` (Bearer) and `sk-ant-api*` (x-api-key) tokens
- **Full Semantic Kernel integration** — `IKernelBuilder.UseClaudeCodeChatCompletion()` one-liner
- **DI-friendly** — `IServiceCollection.AddClaudeCodeAuthentication()` for ASP.NET Core / Generic Host
- **Broad TFM support** — `netstandard2.0`, `net8.0`, `net10.0`
- **Thread-safe credential caching** with double-checked locking via `SemaphoreSlim`

---

## Credential Resolution Order

| Priority | Source | Notes |
|----------|--------|-------|
| 1 | `ClaudeSession:ApiKey` (options/config) | Explicit API key override |
| 2 | `ClaudeSession:OAuthToken` (options/config) | Explicit OAuth token override |
| 3 | `ANTHROPIC_API_KEY` env var | Standard Anthropic env var |
| 4 | `CLAUDE_CODE_OAUTH_TOKEN` env var | CI/CD injection |
| 5 | `~/.claude/.credentials.json` | Claude Code local session file |

---

## Quick Start

### Install

```bash
dotnet add package JD.SemanticKernel.Connectors.ClaudeCode
```

### Kernel Builder (Recommended — net8.0+)

```csharp
using JD.SemanticKernel.Connectors.ClaudeCode;

var kernel = Kernel.CreateBuilder()
    .UseClaudeCodeChatCompletion()   // reads ~/.claude/.credentials.json automatically
    .Build();

var result = await kernel.InvokePromptAsync("Hello, Claude!");
Console.WriteLine(result);
```

### With explicit API key

```csharp
var kernel = Kernel.CreateBuilder()
    .UseClaudeCodeChatCompletion(apiKey: "sk-ant-api...")
    .Build();
```

### Custom model

```csharp
var kernel = Kernel.CreateBuilder()
    .UseClaudeCodeChatCompletion(ClaudeModels.Opus)
    .Build();
```

### Service Collection (ASP.NET Core / Generic Host)

```csharp
// Via delegate
builder.Services.AddClaudeCodeAuthentication(options =>
{
    options.CredentialsPath = "/custom/path/.credentials.json";
});

// Via IConfiguration (binds from "ClaudeSession" section)
builder.Services.AddClaudeCodeAuthentication(builder.Configuration);
```

### Bring-your-own HttpClient

```csharp
var httpClient = ClaudeCodeHttpClientFactory.Create();
var anthropicClient = new AnthropicClient("placeholder", httpClient);
```

### Configuration Section

```json
{
  "ClaudeSession": {
    "ApiKey": null,
    "OAuthToken": null,
    "CredentialsPath": null
  }
}
```

---

## Sample CLI Tools

Three demonstration tools are included in the `samples/` directory:

| Tool | Command | NuGet ID | Description |
|------|---------|----------|-------------|
| **Gherkin Generator** | `jdgerkinator` | `JD.Tools.GherkinGenerator` | Converts acceptance criteria → Gherkin/Reqnroll feature files |
| **PR Review Agent** | `jdpr` | `JD.Tools.PullRequestReviewer` | AI code review for GitHub, Azure DevOps, GitLab |
| **Codebase Explorer** | `jdxplr` | `JD.Tools.CodebaseExplorer` | Profiles codebases into structured knowledgebases |

Install as global .NET tools:

```bash
dotnet tool install -g JD.Tools.GherkinGenerator
dotnet tool install -g JD.Tools.PullRequestReviewer
dotnet tool install -g JD.Tools.CodebaseExplorer
```

---

## Building and Testing

```bash
# Build all projects
dotnet build

# Run all tests
dotnet test

# Build documentation (requires docfx tool restore)
cd docs
dotnet tool restore
dotnet docfx docfx.json
```

> **CI note:** `TreatWarningsAsErrors` is enabled when `$CI=true`. All projects use
> `AnalysisLevel=latest-all` with `EnforceCodeStyleInBuild=true`.

---

## Available Claude Models

Defined in `ClaudeModels` (`src/.../ClaudeModels.cs`):

| Constant | Model ID | Tier |
|----------|----------|------|
| `ClaudeModels.Opus` | `claude-opus-4-6` | Most capable |
| `ClaudeModels.Sonnet` | `claude-sonnet-4-6` | Balanced (default) |
| `ClaudeModels.Haiku` | `claude-haiku-4-5-20251001` | Fastest / cheapest |
| `ClaudeModels.Default` | (alias for Sonnet) | — |

---

## Project Structure

```
ClaudeCodeAuthenticationProvider/
├── src/
│   └── JD.SemanticKernel.Connectors.ClaudeCode/   ← Core library (NuGet package)
├── samples/
│   ├── CodebaseExplorer/   ← jdxplr CLI tool
│   ├── GherkinGenerator/   ← jdgerkinator CLI tool
│   └── PullRequestReviewer/ ← jdpr CLI tool
├── tests/
│   ├── JD.SemanticKernel.Connectors.ClaudeCode.Tests/
│   ├── CodebaseExplorer.Tests/
│   ├── GherkinGenerator.Tests/
│   └── PullRequestReviewer.Tests/
├── docs/                   ← DocFX documentation site
├── Directory.Build.props   ← Shared MSBuild properties
├── Directory.Packages.props ← Central Package Management (CPM)
└── version.json            ← Nerdbank.GitVersioning config
```

---

## Documentation

Full DocFX documentation covers:
- [Getting Started](docs/articles/getting-started.md)
- [Credential Resolution](docs/articles/credential-resolution.md)
- [Kernel Builder Integration](docs/articles/kernel-builder-integration.md)
- [Service Collection Integration](docs/articles/service-collection-integration.md)
- [HttpClientFactory](docs/articles/http-client-factory.md)
- [Configuration Reference](docs/articles/configuration-reference.md)
